<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aleks Report — Pologne</title>
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.1/dist/MarkerCluster.Default.css" />
  <style>
    #map { height:500px; border-radius:8px; margin:1rem 0; }
    #filters { margin:0.5rem 0; display:flex; gap:1rem; align-items:center; flex-wrap:wrap;}
    
    /* Modal styles */
    #imageModal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); }
    #modalImage { margin: auto; display: block; max-width: 90%; max-height: 90%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    #closeModal { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; z-index: 2001; }
  </style>
</head>
<body>
  <header id="site-header">
    <a href="../../index.html" class="logo-link">
      <img src="../../img/logo-miam-bordeaux.png" alt="Mon Report - Accueil" id="site-logo">
    </a>
  </header>

  <p style="margin:1rem 2rem;"><a href="../../index.html">← Retour à la carte du monde</a></p>

  <h2 style="margin-left:2rem;">Voyage en Pologne</h2>

  <div id="filters" style="margin-left:2rem;">
    <label><input type="checkbox" class="type-filter" value="restaurant" checked> Restaurants</label>
    <label><input type="checkbox" class="type-filter" value="café" checked> Cafés</label>
    <label><input type="checkbox" class="type-filter" value="pizzeria" checked> Pizzerias</label>
    <label><input type="checkbox" class="type-filter" value="fast-food" checked> Fast-food</label>
    
    <button class="tag-button" data-tag="VG">#VG</button>
    <button class="tag-button" data-tag="local">#Local</button>
    <button class="tag-button" data-tag="pancakes">#Pancakes</button>
  </div>

  <div id="map"></div>

  <section id="places-list" class="card" style="margin:1rem 2rem;">
    <h3>Adresses en Pologne</h3>
    <div id="places-content">Chargement des données Google Sheet…</div>
  </section>

  <!-- Modal for images -->
  <div id="imageModal">
    <span id="closeModal">&times;</span>
    <img id="modalImage" referrerpolicy="no-referrer">
  </div>

  <footer>
    <hr>
    <p>© 2025 Aleks Report</p>
  </footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.1/dist/leaflet.markercluster.js"></script>
  <script src="../../js/map-loader.js"></script>
  <script>
    // --- CONFIGURATION GOOGLE SHEET ---
    // Remplacez l'URL ci-dessous par le lien d'export CSV de votre Google Sheet
    // Exemple : https://docs.google.com/spreadsheets/d/VOTRE_ID_SHEET/export?format=csv
    const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1h2CegxeHf_ALQDLAeVkLTByXbADVrwu1MPPDv0pZHms/export?format=csv"; 

    initializeMap({
      mapId: 'map',
      listContainerId: 'places-content',
      center: [52.0693, 19.4803], // Centre de la Pologne
      zoom: 7,
      iconBasePath: '../../img/',
      pictureBasePath: '', // Les liens d'images dans le Sheet doivent être complets (http...) ou relatifs corrects
      dataSourceUrl: GOOGLE_SHEET_CSV_URL, // On force l'utilisation du Sheet
      dataFilter: (places) => {
        // Filtre pour ne garder que les lieux en Pologne (Longitude > 10 pour exclure Strasbourg)
        return places.filter(p => parseFloat(p.lng) > 10);
      }
    });

    // Modal functionality
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const closeModal = document.getElementById('closeModal');

    window.openImageModal = function(src) {
      modal.style.display = "block";
      modalImg.src = src;
    }

    closeModal.onclick = function() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>